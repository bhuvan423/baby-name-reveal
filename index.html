<!-- Firebase SDKs (UMD version for use in browser directly) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCV14L7jtHt-2aqnR2jlNhK9uw6j338dHk",
    authDomain: "baby-name-reveal.firebaseapp.com",
    databaseURL: "https://baby-name-reveal-default-rtdb.firebaseio.com",
    projectId: "baby-name-reveal",
    storageBucket: "baby-name-reveal.firebasestorage.app",
    messagingSenderId: "107356853293",
    appId: "1:107356853293:web:bb5d0f4af16ccf661554a4",
    measurementId: "G-YB0K2E26WC"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function logToFirebase(name, status) {
    const timestamp = new Date().toISOString();
    const newRef = db.ref("guests").push();
    newRef.set({
      name: name,
      status: status,
      time: timestamp
    }).catch((error) => {
      console.error("Firebase error:", error);
    });
  }

  function proceedToPassword() {
    const name = document.getElementById("userName").value.trim();
    if (name === "") {
      document.getElementById("nameError").textContent = "âš ï¸ Please enter your name.";
      return;
    }
    localStorage.setItem("guestName", name);
    logToFirebase(name, "Name Entered");
    document.getElementById("nameStage").style.display = "none";
    document.getElementById("passwordStage").classList.remove("hidden");
  }

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    const correct = "GUESSME";
    const name = localStorage.getItem("guestName") || "Unknown";

    if (input === correct) {
      logToFirebase(name, "Access Granted");
      alert("Welcome, " + name + "! ðŸŽ‰");
      document.getElementById("passwordStage").style.display = "none";
      document.getElementById("mainContent").classList.remove("hidden");
    } else {
      logToFirebase(name, "Wrong Password");
      document.getElementById("error").textContent = "âŒ Incorrect password. Try again.";
    }
  }

  // Enable/disable next button
  document.addEventListener("DOMContentLoaded", () => {
    const userNameInput = document.getElementById("userName");
    const nextBtn = document.getElementById("nextBtn");

    userNameInput.addEventListener("input", () => {
      nextBtn.disabled = userNameInput.value.trim() === "";
    });
  });

  // Expose to window for button onclick
  window.proceedToPassword = proceedToPassword;
  window.checkPassword = checkPassword;
</script>
