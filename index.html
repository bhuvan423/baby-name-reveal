<!-- Firebase App (the core Firebase SDK) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCV14L7jtHt-2aqnR2jlNhK9uw6j338dHk",
    authDomain: "baby-name-reveal.firebaseapp.com",
    databaseURL: "https://baby-name-reveal-default-rtdb.firebaseio.com",
    projectId: "baby-name-reveal",
    storageBucket: "baby-name-reveal.firebasestorage.app",
    messagingSenderId: "107356853293",
    appId: "1:107356853293:web:bb5d0f4af16ccf661554a4",
    measurementId: "G-YB0K2E26WC"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  window.logToFirebase = function (name, status) {
    const timestamp = new Date().toISOString();
    const newLogRef = push(ref(db, "guests"));
    set(newLogRef, {
      name: name,
      status: status,
      time: timestamp
    }).catch((error) => {
      console.error("âŒ Firebase write error:", error);
    });
  };

  window.proceedToPassword = function () {
    const name = document.getElementById("userName").value.trim();
    if (name === "") {
      document.getElementById("nameError").textContent = "âš ï¸ Please enter your name.";
      return;
    }
    localStorage.setItem("guestName", name);
    logToFirebase(name, "Name Entered");
    document.getElementById("nameStage").style.display = "none";
    document.getElementById("passwordStage").classList.remove("hidden");
  };

  window.checkPassword = function () {
    const input = document.getElementById("passwordInput").value;
    const correct = "GUESSME";
    const name = localStorage.getItem("guestName") || "Unknown";

    if (input === correct) {
      logToFirebase(name, "Access Granted");
      alert("Welcome, " + name + "! ðŸŽ‰");
      document.getElementById("passwordStage").style.display = "none";
      document.getElementById("mainContent").classList.remove("hidden");
    } else {
      logToFirebase(name, "Wrong Password");
      document.getElementById("error").textContent = "âŒ Incorrect password. Try again.";
    }
  };

  // Enable/Disable next button on name input
  document.addEventListener("DOMContentLoaded", () => {
    const userNameInput = document.getElementById("userName");
    const nextBtn = document.getElementById("nextBtn");

    userNameInput.addEventListener("input", () => {
      nextBtn.disabled = userNameInput.value.trim() === "";
    });
  });
</script>
